!function(e){var t={};function n(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(o,s,function(t){return e[t]}.bind(null,s));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);const{token:o}=JSON.parse(localStorage.getItem("token")),s="http://68.183.27.173:8080";let a=new URLSearchParams(location.search);const i={Accept:"application/json","Content-Type":"application/json",Authorization:`Bearer ${o}`};let l=e=>{return new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"})};const r=()=>{document.getElementById("main").innerHTML="",(()=>fetch(`${s}/post`,{method:"GET",headers:i}).then(e=>e.json()).then(e=>e))().then(e=>{Object.keys(e).map(t=>{document.getElementById("main").innerHTML+=(({body:e,id:t,title:n,userId:o,liked:s,likes:a,views:i,createdAt:r,userName:c,tags:d,comments:p})=>`<div class="post">\n                <span hidden id="liked-${t}">${s}</span>\n               <div>\n                <div class="post-like">\n                    <button type="button" id="like-d-${t}" class="like-icon">\n                        <i id="like-${t}" class="li ${Boolean(s)?"fas":"far"} fa-star"></i>\n                    </button>\n                    <h3>\n                        <a href="./post.html?id=${t}" class="post-title">${n}</a>\n                    </h3>\n                    \n                </div>\n               </div>\n               <p class="post-body">${e.substring(0,199)}<a href="./post.html?id=${t}"> ...m√°s</a></p>\n               <div class="post-footer">\n                    <span class="post-fecha">${l(r)}</span>\n                    <span class="post-by">by: <a class="post-name" href="/public/perfil.html?id=${o}">${c}</a>\n                    </span>\n                    <spam class="like"><i class="far fa-eye"></i>     ${i}</spam>\n                    <span class="like"><i class="fas fa-star"></i>     ${a}</span >\n                    <span class="like"><i class="far fa-comments"></i>     ${p}</span >\n                </div>\n                <div class="post-footer">\n                    ${d}\n                </div>\n            </div>`)(e[t])})}).catch(e=>console.log(e,"error"))},c=()=>{document.getElementById("main").innerHTML="",document.getElementById("main").innerHTML='\n    <div class="login-container post-register .title-login">\n        <h3 >Post -ADD </h3>\n        <form action="">\n            <input id="post-title"class="form-control" type="text" placeholder="TITULO">\n            <textarea name="" id="post-area" class="post-textarea" placeholder="Comentarios"></textarea>\n            <div class="tags" >\n                <input class="form-control" type="text" id="tarea" placeholder="Categoria">\n                <button type="button" class="btn btn-primary" id="tags-btn">Agregar</button>\n            </div>\n            <div class="categorias">\n                <ul class="tags-list" id="tags-list">\n                </ul>\n            </div>\n            <div class="action-login">\n                <button type="button" class="btn" id="btn-post">Enviar</button>\n            </div>\n            \n\n        </form>\n    </div>'},d=e=>{(e=>{console.log("post add");let t=document.getElementById("post-area").value,n=document.getElementById("post-title").value;if(console.log("size body: ",String(t).length," title :",n.length," tags : ",e.length),t.length<100||n.length<3||e.length<1)return;let o={title:n,body:t,tags:e};return fetch(`${s}/post`,{method:"POST",body:JSON.stringify(o),headers:i}).then(e=>{if(console.log(e.status),201===e.status)return e.json();throw new Error("Error al agregar post")})})(e).then(e=>{let{id:t}=e;t&&r()}).catch(e=>console.log(e))},p=e=>{let t=document.getElementById(`liked-${e}`),n=document.getElementById(`like-d-${e}`);"true"!=String(t.innerText)?(e=>fetch(`${s}/post/${e}/like`,{method:"PUT",headers:i}).then(e=>e))(e).then(o=>{if(!o.ok)throw Error("Error al hacer like");n.innerHTML=`<i id="like-${e}" class='fas fa-star'></i>`,t.innerHTML="true",console.log("tiene like",t)}).catch(e=>console.log(e)):(console.log("no tiene like"),(e=>fetch(`${s}/post/${e}/like`,{method:"DELETE",headers:i}).then(e=>e))(e).then(o=>{if(!o.ok)throw Error("Error al hacer like");n.innerHTML=`<i id="like-${e}"  class='far fa-star'></i>`,t.innerHTML="false"}))},m=e=>fetch(`${s}/users/${e}`,{method:"GET",headers:i}).then(e=>e.json()).then(e=>e),h=({body:e,userName:t})=>`<div class="comment-text">\n                <p>${e}</p>\n                <span>by: <a href="/public/perfil.html?id=1">${t}</a></span>\n            </div>`,u=()=>{(()=>{let e=new URLSearchParams(location.search);return fetch(`${s}/post/${e.get("id")}`,{method:"GET",headers:i}).then(e=>{if(e.ok)return console.log(e),e.json();throw Error("Post by id error")})})().then(e=>{m(e.userId).then(t=>{document.getElementById("main").innerHTML=(({title:e,body:t,userId:n,liked:o,id:s,createdAt:a,userName:i,likes:r,views:c,comments:d})=>` \n        <div class="post">\n        <div>\n            <div class="post-like">\n                <div id="like-d-${s}" class="like-icon">\n                    <i id="like-${s}" class="li ${Boolean(o)?"fas":"far"} fa-star"></i>\n                </div>\n                <h3 class="post-title no-pointer">\n                    ${e}\n                </h3>\n            </div>\n       </div>\n       <div class="post-footer">\n            <span class="post-fecha">${l(a)}</span>\n            <span class="post-by">by: <a class="post-name" href="/public/perfil.html?id=${n}">${i}</a>\n            </span>\n            <spam class="like"><i class="far fa-eye"></i>      ${c}</spam>\n            <span class="like"><i class="fas fa-star"></i>     ${r}</span>\n            <span><i class="far fa-comments"></i>   ${d}</span>\n        </div>\n            <p class="post-body">${t}</p>\n            \n         </div>`)(e)}).catch(e=>console.log(e)),g(a.get("id"))}).catch(e=>console.log(e))},g=e=>{console.log("comentarios"),(e=>fetch(`${s}/post/${e}/comment`,{method:"GET",headers:i}).then(e=>{if(e.ok)return e.json();throw Error("fallo el connect del comment by post ID")}))(e).then(e=>{console.log("comentarios res:",e);let t=Object.keys(e).map(t=>{document.getElementById("comment").innerHTML+=h(e[t])});console.log(t)}).catch(e=>console.log(e))},f=()=>{let e=new URLSearchParams(location.search),t=document.getElementById("post-comment").value;if(t.length<=3)return console.log("error"),void(document.getElementById("comment-info").style.visibility="visible");document.getElementById("comment-info").style.visibility="hidden";let n={body:t};((e,t)=>fetch(`${s}/post/${e}/comment`,{method:"POST",body:JSON.stringify(t),headers:i}).then(e=>{if(e.ok)return e.json();throw Error("Error crear post")}))(e.get("id"),n).then(e=>{m(e.userId).then(t=>{document.getElementById("comment").innerHTML+=h(e)}),document.getElementById("post-comment").value=""})},y=()=>{let e=new URLSearchParams(location.search).get("id");console.log("user id: ",e),m(e).then(e=>(document.getElementById("perfil").innerHTML=(({name:e,email:t,createdAt:n,posts:o})=>` \n    <figure class="perfil-avatar">\n        <img src="/assets/img/avatar.png" alt="${e}">\n        <figcaption>${e}</figcaption>\n        <figcaption>Fecha Creado : ${l(n)}</figcaption>\n    </figure>\n    <div class="perfil-description flex-row align-i-center">\n        <h4>Total de Post:</h4> <h5>${o}</h5>\n    </div>\n    <div class="perfil-description flex-row align-i-center">\n        <h4>Email:</h4> <h5>${t}</h5>\n    </div>\n    `)(e),e)).then(e=>{console.log(e),(async e=>{let t=await fetch(`${s}/post?userId=${e}`,{method:"GET",headers:i});if(!t.ok)throw Error("error listando post by id");return t.json()})(e.id).then(e=>{Object.keys(e).map(t=>{document.getElementById("perfil-post").innerHTML+=(({id:e,title:t,likes:n,views:o,comments:s,tags:a})=>`<div class="comment-text">\n                <a href="/public/post.html?id=${e}"><h3>${t}</h3></a>\n                <div class="">\n                    <span><i class="fas fa-star"></i>  ${n}</span>\n                    <span><i class="far fa-eye"></i>   ${o}</span>\n                    <span><i class="far fa-comments"></i>   ${s}</span>\n                    <spa>${a}</span>\n                </div>\n            </div>`)(e[t])})})})},v=()=>{fetch(`${s}/logout`,{method:"DELETE",headers:{"Content-Type":"application/json"}}).then(e=>{window.location="/public/login.html"}).catch(e=>{}),localStorage.removeItem("token")};let b=e=>{document.getElementById("tags-list").innerHTML="",e.forEach((e,t)=>{document.getElementById("tags-list").innerHTML+=`<li class='tags-li'><span>${e}</span>  <span class='tags-delete' id="${e}-${t}">  x</span></li>`})};const $=()=>{(()=>fetch(`${s}/users`,{method:"GET",headers:i}).then(e=>{if(e.ok)return e.json();throw Error("error en el getUsers")}))().then(e=>{Object.keys(e).map(t=>{document.getElementById("usuarios-container").innerHTML+=(({name:e,createdAt:t,email:n,posts:o,id:s})=>`\n    <div class="usuarios-container flex-row j-center f-wrap">\n        <a href="/public/perfil.html?id=${s}">\n            <figure class="usuarios-figure" >\n                <img src="/assets/img/avatar.png" alt="${e}">\n                <figcaption>${e}</figcaption>\n                <figcaption>${l(t)} </figcaption>\n            </figure>\n        </a>\n        <div class="description flex-column">\n            <h3>Description</h3>\n            <span class="c-violet"><i class="far fa-envelope c-green"></i>  Email : ${n} </span>\n            <span class="c-violet"><i class="far fa-newspaper c-blue"></i>  Post Publicado : ${o} </span>\n        </div>\n    </div>`)(e[t])})})};let E=[];localStorage.getItem("token")?((()=>{let{id:e,name:t,email:n,token:o}=JSON.parse(localStorage.getItem("token"));console.log(t,"nombre index"),document.getElementById("name").innerText=t})(),"/public/perfil.html"===location.pathname&&y(),"/public/post.html"===location.pathname&&(u(),document.getElementById("btn-comment").addEventListener("click",f)),"/public/usuarios.html"===location.pathname&&$(),console.log(location),"/public/index.html"===location.pathname&&(document.getElementById("logout").addEventListener("click",v),document.getElementById("post-add").addEventListener("click",c),r(),document.addEventListener("click",function(e){if(console.log("estamos aqui",e),"tags-btn"===e.target.id&&document.getElementById("tags-btn").addEventListener("click",(e=>{console.log("hola add categoria");let t=document.getElementById("tarea"),n=String(t.value).toLocaleUpperCase();if(!(e.find(e=>e===n)||""===n||e.length>4))return e.push(n),console.log(e),b(e),t.value="",e})(E)),"SPAN"===e.target.nodeName&&(console.log("hola mundo papa",e.target.id),((e,t)=>{let n=e.split("-");console.log("index",n[1]),t.splice(n[1],1),b(t)})(e.target.id,E)),"btn-post"===e.target.id&&document.getElementById("btn-post").addEventListener("click",d(E)),"BUTTON"===e.target.nodeName){let t=String(e.target.id).split("-");"like"===t[0]&&(p(t[2]),console.log(t[2]))}}))):window.location="/public/login.html"}]);